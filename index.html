<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ”¾ç½®ãƒã‚¤ãƒ³ãƒˆ</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      text-align: center;
      padding-top: 40px;
    }
    .pt {
      font-size: 3em;
      font-weight: bold;
    }
    .level {
      margin-top: 10px;
      font-size: 1.2em;
    }
    .ach {
      margin-top: 20px;
      color: green;
    }
  </style>
</head>
<body>
  <h1>æ”¾ç½®ãƒã‚¤ãƒ³ãƒˆã‚²ãƒ¼ãƒ </h1>
  <div class="pt"><span id="pt">0</span> pt</div>
  <div class="level">Lv.<span id="lv">1</span></div>
  <div class="ach" id="ach"></div>

  <script>
    /* ===== è¨­å®š ===== */
    const RATE = 100; // 1ç§’ã‚ãŸã‚Š100pt
    const KEY_POINT = "bg_point";
    const KEY_TIME = "bg_last";
    const KEY_ACH = "bg_ach";

    /* ===== èª­ã¿è¾¼ã¿ ===== */
    let point = Number(localStorage.getItem(KEY_POINT)) || 0;
    let last = Number(localStorage.getItem(KEY_TIME)) || Date.now();
    let achievements = JSON.parse(localStorage.getItem(KEY_ACH) || "[]");

    /* ===== é–‰ã˜ã¦ãŸæ™‚é–“åˆ†ã‚’åŠ ç®— ===== */
    const now = Date.now();
    const diffSec = (now - last) / 1000;
    point += Math.floor(diffSec * RATE);

    /* ===== è¡¨ç¤ºè¦ç´  ===== */
    const ptEl = document.getElementById("pt");
    const lvEl = document.getElementById("lv");
    const achEl = document.getElementById("ach");

    /* ===== ãƒ¬ãƒ™ãƒ«è¨ˆç®— ===== */
    function getLevel(pt) {
      return Math.floor(Math.sqrt(pt / 100)) + 1;
    }

    /* ===== å®Ÿç¸¾ ===== */
    const ACH_LIST = [
      { id: "1000", pt: 1000, text: "ğŸ‰ 1000pté”æˆï¼" },
      { id: "10000", pt: 10000, text: "ğŸ”¥ 10000pté”æˆï¼" },
      { id: "100k", pt: 100000, text: "ğŸ‘‘ 100000pté”æˆï¼" }
    ];

    function checkAchievements() {
      for (const a of ACH_LIST) {
        if (point >= a.pt && !achievements.includes(a.id)) {
          achievements.push(a.id);
          achEl.textContent = a.text;
        }
      }
      localStorage.setItem(KEY_ACH, JSON.stringify(achievements));
    }

    /* ===== ãªã‚ã‚‰ã‹åŠ ç®—ï¼ˆãƒŸãƒªç§’ï¼‰ ===== */
    let lastFrame = performance.now();
    function loop(nowMs) {
      const delta = (nowMs - lastFrame) / 1000;
      lastFrame = nowMs;

      point += delta * RATE;
      ptEl.textContent = Math.floor(point);
      lvEl.textContent = getLevel(point);

      checkAchievements();
      requestAnimationFrame(loop);
    }

    /* ===== ä¿å­˜ ===== */
    function save() {
      localStorage.setItem(KEY_POINT, Math.floor(point));
      localStorage.setItem(KEY_TIME, Date.now());
    }

    window.addEventListener("beforeunload", save);
    setInterval(save, 5000);

    /* ===== åˆæœŸè¡¨ç¤º ===== */
    ptEl.textContent = Math.floor(point);
    lvEl.textContent = getLevel(point);
    requestAnimationFrame(loop);
  </script>
</body>
</html>
