<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ”¾ç½®ãƒã‚¤ãƒ³ãƒˆ</title>
<style>
body{font-family:system-ui;text-align:center;padding:30px}
.pt{font-size:3em;font-weight:bold}
.shop button{margin:6px;padding:8px 14px}
.bar{width:80%;height:14px;background:#ddd;margin:10px auto;border-radius:7px;overflow:hidden}
.bar>div{height:100%;background:#4caf50}
.small{color:#666;font-size:.9em}
</style>
</head>
<body>

<h1>æ”¾ç½®ãƒã‚¤ãƒ³ãƒˆ</h1>
<div class="pt"><span id="pt">0</span>pt</div>
<div>Lv.<span id="lv">1</span></div>
<div class="bar"><div id="bar"></div></div>
<div class="small">æ¬¡Lvã¾ã§ <span id="next">0</span>pt</div>

<h2>ã‚·ãƒ§ãƒƒãƒ—</h2>
<div class="shop">
<button onclick="buyBoost(1.5,30000,10000)">ğŸš€1.5å€(30ç§’)</button>
<button onclick="buyBoost(2,15000,25000)">âš¡2å€(15ç§’)</button><br>
<button onclick="buyPerm(1.2,50000)">â«å¸¸æ™‚+20%</button>
<button onclick="buyPerm(1.5,200000)">ğŸ’å¸¸æ™‚+50%</button><br>
<button onclick="daily()">ğŸãƒ‡ã‚¤ãƒªãƒ¼</button>
</div>

<p id="info"></p>

<script>
/* ===== è¨­å®š ===== */
const BASE = 100;
const K={p:"p",t:"t",b:"b",m:"m",d:"d"};
let p=+localStorage.getItem(K.p)||0;
let last=+localStorage.getItem(K.t)||Date.now();
let boostUntil=+localStorage.getItem(K.b)||0;
let perm=+localStorage.getItem(K.m)||1;
let dailyLast=+localStorage.getItem(K.d)||0;

/* é–‰ã˜ã¦ãŸåˆ† */
p+=Math.floor((Date.now()-last)/1000)*BASE;

/* ãƒ¬ãƒ™ãƒ« */
const lvl=pt=>Math.floor(Math.sqrt(pt/200))+1;
const need=lv=>lv*lv*200;

/* UI */
const ptEl=pt,lvEl=lv,bar=bar,next=next,info=info;
function ui(){
 ptEl.textContent=Math.floor(p);
 const l=lvl(p); lvEl.textContent=l;
 const n=need(l+1)-p; next.textContent=Math.max(0,Math.floor(n));
 bar.style.width=Math.min(100,(1-n/need(l+1))*100)+"%";
}

/* ãƒ–ãƒ¼ã‚¹ãƒˆ */
function rate(){
 let r=BASE*perm;
 if(Date.now()<boostUntil) r*=boostMul;
 return r;
}
let boostMul=1;
function buyBoost(mul,time,cost){
 if(p<cost||Date.now()<boostUntil)return;
 p-=cost; boostMul=mul; boostUntil=Date.now()+time;
}

/* æ°¸ç¶š */
function buyPerm(mul,cost){
 if(p<cost)return;
 p-=cost; perm*=mul;
 localStorage.setItem(K.m,perm);
}

/* ãƒ‡ã‚¤ãƒªãƒ¼ */
function daily(){
 const now=Date.now();
 if(now-dailyLast<86400000){info.textContent="ä»Šæ—¥ã¯ã‚‚ã†å—å–æ¸ˆã¿";return;}
 p+=5000; dailyLast=now; localStorage.setItem(K.d,now);
}

/* ãƒ«ãƒ¼ãƒ— */
let lf=performance.now();
function loop(n){
 const d=(n-lf)/1000; lf=n;
 p+=d*rate();
 ui(); requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ä¿å­˜ */
setInterval(()=>{
 localStorage.setItem(K.p,Math.floor(p));
 localStorage.setItem(K.t,Date.now());
 localStorage.setItem(K.b,boostUntil);
},5000);
</script>
</body>
</html>
