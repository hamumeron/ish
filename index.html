<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ”¾ç½®ãƒã‚¤ãƒ³ãƒˆDX</title>
<style>
body{font-family:system-ui;background:#f4f6fa;margin:0}
nav{display:flex;background:#222}
nav button{flex:1;padding:14px;border:0;color:#fff;background:#222}
nav button.active{background:#4caf50}
.tab{display:none;padding:20px}
.tab.active{display:block}
.card{background:#fff;border-radius:12px;padding:16px;margin:12px auto;max-width:420px;box-shadow:0 4px 14px #0001}
.pt{font-size:3em;font-weight:800;text-align:center}
button.shop{width:100%;padding:12px;margin:6px 0;border:0;border-radius:8px}
button:disabled{opacity:.4}
.small{font-size:.85em;color:#555}
</style>
</head>
<body>

<nav>
  <button onclick="openTab('home')" class="active">ğŸ  ãƒ›ãƒ¼ãƒ </button>
  <button onclick="openTab('shop')">ğŸ›’ ã‚·ãƒ§ãƒƒãƒ—</button>
  <button onclick="openTab('ach')">ğŸ† å®Ÿç¸¾</button>
</nav>

<div id="home" class="tab active">
  <div class="card">
    <div class="pt"><span id="pt">0</span> pt</div>
    <div style="text-align:center">Lv.<span id="lv">1</span></div>
    <div class="small" style="text-align:center">
      å€ç‡ï¼š<span id="mul">1.00</span>x /
      ãƒ–ãƒ¼ã‚¹ãƒˆï¼š<span id="boost">ãªã—</span>
    </div>
  </div>
</div>

<div id="shop" class="tab">
  <div class="card">
    <h3>ğŸ›’ ã‚·ãƒ§ãƒƒãƒ—</h3>

    <button class="shop" onclick="buyBoost(1.5,30,10000)">
      ğŸš€ 1.5å€ï¼ˆ30ç§’ï¼‰<br>10,000pt
    </button>

    <button class="shop" onclick="buyBoost(2,15,25000)">
      âš¡ 2å€ï¼ˆ15ç§’ï¼‰<br>25,000pt
    </button>

    <button class="shop" onclick="buyPerm(1.2,50000)">
      â« å¸¸æ™‚+20%<br>50,000pt
    </button>

    <button class="shop" onclick="buyPerm(1.5,200000)">
      ğŸ’ å¸¸æ™‚+50%<br>200,000pt
    </button>
  </div>
</div>

<div id="ach" class="tab">
  <div class="card">
    <h3>ğŸ† å®Ÿç¸¾</h3>
    <div id="achList"></div>
  </div>
</div>

<script>
/* ===== ã‚¿ãƒ– ===== */
function openTab(id){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  event.target.classList.add("active");
}

/* ===== DOM ===== */
const ptEl = document.getElementById("pt");
const lvEl = document.getElementById("lv");
const mulEl = document.getElementById("mul");
const boostEl = document.getElementById("boost");
const achList = document.getElementById("achList");

/* ===== è¨­å®š ===== */
const BASE = 100; // 1ç§’100pt
const KEY = {
  pt:"pt", last:"last", perm:"perm", boost:"boost", until:"until", total:"total"
};

/* ===== èª­ã¿è¾¼ã¿ ===== */
let point = Number(localStorage.getItem(KEY.pt)) || 0;
let total = Number(localStorage.getItem(KEY.total)) || point;
let permMul = Number(localStorage.getItem(KEY.perm)) || 1;
let boostMul = Number(localStorage.getItem(KEY.boost)) || 1;
let boostUntil = Number(localStorage.getItem(KEY.until)) || 0;
let last = Number(localStorage.getItem(KEY.last)) || Date.now();

/* ===== ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åŠ ç®— ===== */
const now = Date.now();
point += Math.floor((now - last)/1000) * BASE;

/* ===== ãƒ¬ãƒ™ãƒ« ===== */
const level = p => Math.floor(Math.sqrt(p/200))+1;

/* ===== è³¼å…¥ ===== */
function buyBoost(m,sec,cost){
  if(point<cost || Date.now()<boostUntil) return;
  point -= cost;
  boostMul = m;
  boostUntil = Date.now() + sec*1000;
}
function buyPerm(m,cost){
  if(point<cost) return;
  point -= cost;
  permMul *= m;
}

/* ===== ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ— ===== */
let prev = performance.now();
function loop(t){
  const d = (t-prev)/1000; prev=t;
  const activeBoost = Date.now()<boostUntil ? boostMul : 1;
  const inc = d * BASE * permMul * activeBoost;
  point += inc;
  total += inc;

  ptEl.textContent = Math.floor(point);
  lvEl.textContent = level(point);
  mulEl.textContent = permMul.toFixed(2);
  boostEl.textContent = activeBoost>1
    ? activeBoost+"x ("+Math.ceil((boostUntil-Date.now())/1000)+"s)"
    : "ãªã—";

  achList.innerHTML = "";
  if(total>=10000) achList.innerHTML+="ğŸ‰ 10,000pté”æˆ<br>";
  if(permMul>=2) achList.innerHTML+="ğŸ’ å¸¸æ™‚2å€ä»¥ä¸Š<br>";

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ===== ä¿å­˜ ===== */
setInterval(()=>{
  localStorage.setItem(KEY.pt,Math.floor(point));
  localStorage.setItem(KEY.total,Math.floor(total));
  localStorage.setItem(KEY.perm,permMul);
  localStorage.setItem(KEY.boost,boostMul);
  localStorage.setItem(KEY.until,boostUntil);
  localStorage.setItem(KEY.last,Date.now());
},5000);
</script>
</body>
</html>
