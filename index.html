<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ”¾ç½®ãƒã‚¤ãƒ³ãƒˆ</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      text-align: center;
      padding-top: 40px;
    }
    .pt {
      font-size: 3em;
      font-weight: bold;
    }
    .level {
      margin-top: 5px;
      font-size: 1.2em;
    }
    .boost {
      margin-top: 20px;
    }
    button {
      font-size: 1em;
      padding: 10px 20px;
    }
    .info {
      margin-top: 10px;
      color: #555;
    }
    .ach {
      margin-top: 15px;
      color: green;
    }
  </style>
</head>
<body>
  <h1>æ”¾ç½®ãƒã‚¤ãƒ³ãƒˆã‚²ãƒ¼ãƒ </h1>

  <div class="pt"><span id="pt">0</span> pt</div>
  <div class="level">Lv.<span id="lv">1</span></div>

  <div class="boost">
    <button id="boostBtn">ğŸš€ 1.5å€ãƒ–ãƒ¼ã‚¹ãƒˆï¼ˆ10000ptï¼‰</button>
    <div class="info" id="boostInfo">æœªä½¿ç”¨</div>
  </div>

  <div class="ach" id="ach"></div>

  <script>
    /* ===== è¨­å®š ===== */
    const BASE_RATE = 100;           // 1ç§’100pt
    const BOOST_RATE = 1.5;
    const BOOST_COST = 10000;
    const BOOST_TIME = 30 * 1000;    // 30ç§’

    const KEY_P = "bg_point";
    const KEY_T = "bg_last";
    const KEY_B = "bg_boost_until";
    const KEY_A = "bg_ach";

    /* ===== èª­ã¿è¾¼ã¿ ===== */
    let point = Number(localStorage.getItem(KEY_P)) || 0;
    let last = Number(localStorage.getItem(KEY_T)) || Date.now();
    let boostUntil = Number(localStorage.getItem(KEY_B)) || 0;
    let achievements = JSON.parse(localStorage.getItem(KEY_A) || "[]");

    /* ===== é–‰ã˜ã¦ãŸæ™‚é–“åˆ†åŠ ç®— ===== */
    const now = Date.now();
    const diffSec = (now - last) / 1000;
    point += Math.floor(diffSec * BASE_RATE);

    /* ===== è¦ç´  ===== */
    const ptEl = document.getElementById("pt");
    const lvEl = document.getElementById("lv");
    const achEl = document.getElementById("ach");
    const boostBtn = document.getElementById("boostBtn");
    const boostInfo = document.getElementById("boostInfo");

    /* ===== ãƒ¬ãƒ™ãƒ« ===== */
    function getLevel(pt) {
      return Math.floor(Math.sqrt(pt / 100)) + 1;
    }

    /* ===== å®Ÿç¸¾ ===== */
    const ACH_LIST = [
      { id: "1k", pt: 1000, text: "ğŸ‰ 1000pté”æˆ" },
      { id: "10k", pt: 10000, text: "ğŸ”¥ 10000pté”æˆ" },
      { id: "100k", pt: 100000, text: "ğŸ‘‘ 100000pté”æˆ" }
    ];

    function checkAchievements() {
      for (const a of ACH_LIST) {
        if (point >= a.pt && !achievements.includes(a.id)) {
          achievements.push(a.id);
          achEl.textContent = a.text;
        }
      }
      localStorage.setItem(KEY_A, JSON.stringify(achievements));
    }

    /* ===== ãƒ–ãƒ¼ã‚¹ãƒˆå‡¦ç† ===== */
    function isBoost() {
      return Date.now() < boostUntil;
    }

    boostBtn.onclick = () => {
      if (isBoost()) return;
      if (point < BOOST_COST) {
        alert("ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“");
        return;
      }
      point -= BOOST_COST;
      boostUntil = Date.now() + BOOST_TIME;
      localStorage.setItem(KEY_B, boostUntil);
    };

    /* ===== è¡¨ç¤ºæ›´æ–° ===== */
    function updateBoostUI() {
      if (isBoost()) {
        const remain = Math.ceil((boostUntil - Date.now()) / 1000);
        boostInfo.textContent = `ğŸš€ ãƒ–ãƒ¼ã‚¹ãƒˆä¸­ï¼ˆæ®‹ã‚Š ${remain}sï¼‰`;
        boostBtn.disabled = true;
      } else {
        boostInfo.textContent = "æœªä½¿ç”¨";
        boostBtn.disabled = false;
      }
    }

    /* ===== ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ï¼ˆãƒŸãƒªç§’ï¼‰ ===== */
    let lastFrame = performance.now();
    function loop(nowMs) {
      const delta = (nowMs - lastFrame) / 1000;
      lastFrame = nowMs;

      const rate = BASE_RATE * (isBoost() ? BOOST_RATE : 1);
      point += delta * rate;

      ptEl.textContent = Math.floor(point);
      lvEl.textContent = getLevel(point);

      updateBoostUI();
      checkAchievements();
      requestAnimationFrame(loop);
    }

    /* ===== ä¿å­˜ ===== */
    function save() {
      localStorage.setItem(KEY_P, Math.floor(point));
      localStorage.setItem(KEY_T, Date.now());
    }
    window.addEventListener("beforeunload", save);
    setInterval(save, 5000);

    /* ===== åˆæœŸè¡¨ç¤º ===== */
    ptEl.textContent = Math.floor(point);
    lvEl.textContent = getLevel(point);
    updateBoostUI();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
