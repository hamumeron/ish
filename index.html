<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ”¾ç½®ãƒã‚¤ãƒ³ãƒˆ</title>
<style>
body{font-family:system-ui;text-align:center;padding:30px}
.pt{font-size:3em;font-weight:bold}
.shop button{margin:6px;padding:8px 14px}
.bar{width:80%;height:14px;background:#ddd;margin:10px auto;border-radius:7px;overflow:hidden}
.bar>div{height:100%;background:#4caf50;width:0%}
.small{color:#666;font-size:.9em}
</style>
</head>
<body>

<h1>æ”¾ç½®ãƒã‚¤ãƒ³ãƒˆ</h1>
<div class="pt"><span id="pt">0</span>pt</div>
<div>Lv.<span id="lv">1</span></div>
<div class="bar"><div id="bar"></div></div>
<div class="small">æ¬¡Lvã¾ã§ <span id="next">0</span>pt</div>

<h2>ã‚·ãƒ§ãƒƒãƒ—</h2>
<div class="shop">
<button onclick="buyBoost(1.5,30000,10000)">ğŸš€1.5å€(30ç§’)</button>
<button onclick="buyBoost(2,15000,25000)">âš¡2å€(15ç§’)</button><br>
<button onclick="buyPerm(1.2,50000)">â«å¸¸æ™‚+20%</button>
<button onclick="buyPerm(1.5,200000)">ğŸ’å¸¸æ™‚+50%</button><br>
<button onclick="daily()">ğŸãƒ‡ã‚¤ãƒªãƒ¼</button>
</div>

<p id="info"></p>

<script>
/* ===== DOM ===== */
const ptEl = document.getElementById("pt");
const lvEl = document.getElementById("lv");
const barEl = document.getElementById("bar");
const nextEl = document.getElementById("next");
const infoEl = document.getElementById("info");

/* ===== è¨­å®š ===== */
const BASE = 100;
const KEY = {
  p:"p", t:"t", b:"b", m:"m", d:"d"
};

let point = Number(localStorage.getItem(KEY.p)) || 0;
let lastTime = Number(localStorage.getItem(KEY.t)) || Date.now();
let boostUntil = Number(localStorage.getItem(KEY.b)) || 0;
let permMul = Number(localStorage.getItem(KEY.m)) || 1;
let dailyLast = Number(localStorage.getItem(KEY.d)) || 0;
let boostMul = 1;

/* ===== ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åŠ ç®— ===== */
const offlineSec = Math.floor((Date.now() - lastTime) / 1000);
point += offlineSec * BASE;

/* ===== ãƒ¬ãƒ™ãƒ« ===== */
const level = p => Math.floor(Math.sqrt(p / 200)) + 1;
const need = lv => lv * lv * 200;

/* ===== UIæ›´æ–° ===== */
function updateUI(){
  ptEl.textContent = Math.floor(point);
  const lv = level(point);
  lvEl.textContent = lv;

  const remain = need(lv + 1) - point;
  nextEl.textContent = Math.max(0, Math.floor(remain));

  const percent = Math.min(100, (1 - remain / need(lv + 1)) * 100);
  barEl.style.width = percent + "%";
}

/* ===== ãƒ¬ãƒ¼ãƒˆ ===== */
function currentRate(){
  let r = BASE * permMul;
  if (Date.now() < boostUntil) r *= boostMul;
  return r;
}

/* ===== è³¼å…¥ ===== */
function buyBoost(mul, time, cost){
  if (point < cost || Date.now() < boostUntil) return;
  point -= cost;
  boostMul = mul;
  boostUntil = Date.now() + time;
}

function buyPerm(mul, cost){
  if (point < cost) return;
  point -= cost;
  permMul *= mul;
  localStorage.setItem(KEY.m, permMul);
}

/* ===== ãƒ‡ã‚¤ãƒªãƒ¼ ===== */
function daily(){
  const now = Date.now();
  if (now - dailyLast < 86400000){
    infoEl.textContent = "ä»Šæ—¥ã¯å—å–æ¸ˆã¿";
    return;
  }
  point += 5000;
  dailyLast = now;
  localStorage.setItem(KEY.d, now);
  infoEl.textContent = "ãƒ‡ã‚¤ãƒªãƒ¼ +5000pt";
}

/* ===== ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ï¼ˆãƒŸãƒªç§’è¨ˆç®—ï¼‰ ===== */
let lastFrame = performance.now();
function loop(now){
  const delta = (now - lastFrame) / 1000;
  lastFrame = now;

  point += delta * currentRate();
  updateUI();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ===== ä¿å­˜ ===== */
setInterval(()=>{
  localStorage.setItem(KEY.p, Math.floor(point));
  localStorage.setItem(KEY.t, Date.now());
  localStorage.setItem(KEY.b, boostUntil);
}, 5000);

updateUI();
</script>
</body>
</html>
